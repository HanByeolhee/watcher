<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.watcher.business.management.mapper.ManagementMapper">
	<select id="getManagerSettings" resultType="map" parameterType="managementParam">
		SELECT
			  ID
			, REG_ID
			, DATE_FORMAT(REG_DATE,'%Y-%m-%d %H:%i') AS REG_DATE
            , UPT_ID
            , DATE_FORMAT(UPT_DATE,'%Y-%m-%d %H:%i') AS UPT_DATE
		    , LOGIN_ID
            , COMMENT_PERM_STATUS
		FROM MEM_MANAGEMENT
		WHERE LOGIN_ID = #{loginId}
	</select>

	<update id="updateManagement" parameterType="managementParam">
		UPDATE MEM_MANAGEMENT SET
		<if test="commentPermStatus != null and commentPermStatus != ''">
			COMMENT_PERM_STATUS 	= #{commentPermStatus} ,
		</if>
		UPT_ID 	= #{loginId} ,
		UPT_DATE 	= NOW()
		WHERE LOGIN_ID = #{loginId}
	</update>

	<insert id="insertManagement" parameterType="managementParam" useGeneratedKeys="true" keyColumn="loginId">
		INSERT INTO MEM_MANAGEMENT(
								   LOGIN_ID
								  ,REG_ID
								  ,REG_DATE
								  ,UPT_ID
								  ,UPT_DATE
								  ,COMMENT_PERM_STATUS
		)
		VALUES (
				   #{loginId}
			   ,#{loginId}
			   ,NOW()
			   ,#{loginId}
			   ,NOW()
			   ,'01'
			   )

		ON DUPLICATE KEY UPDATE
		<if test="commentPermStatus != null and commentPermStatus != ''">
			COMMENT_PERM_STATUS 	= #{commentPermStatus} ,
		</if>
		UPT_ID 	= #{loginId} ,
		UPT_DATE 	= NOW()
	</insert>


</mapper>